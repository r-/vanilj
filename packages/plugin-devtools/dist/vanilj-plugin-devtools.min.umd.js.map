{"version":3,"file":"vanilj-plugin-devtools.min.umd.js","sources":["../src/devtools.js","../src/index.js"],"sourcesContent":["// vanilj-plugins/devtools.js\r\n\r\nimport { useVaniljPlugin } from '@vanilj/core'\r\n\r\nconst snapshots = []\r\nlet currentIndex = -1\r\nconst watchers = new Set()\r\nconst filters = new Set()\r\nlet devtoolsConfig = {\r\n  logOnly: null // e.g. Set of names or IDs\r\n}\r\n\r\nexport function useVaniljDevtools({ maxSnapshots = 100 } = {}) {\r\n  console.log('%c🛠️ Vanilj DevTools active', 'color: #0af')\r\n\r\n  // Add plugin hook\r\n  useVaniljPlugin((event, data) => {\r\n    if (event === 'signal:create') {\r\n      const signal = data.signal\r\n\r\n      // Optional: Assign name for filtering\r\n      if (data.name) signal.__devName = data.name\r\n\r\n      // Patch setter for logging and history\r\n      const orig = Object.getOwnPropertyDescriptor(signal, 'value')\r\n      Object.defineProperty(signal, 'value', {\r\n        get: orig.get,\r\n        set(newValue) {\r\n          const oldValue = orig.get.call(signal)\r\n          orig.set.call(signal, newValue)\r\n\r\n          if (!signal.__skipDevLog && matchFilter(signal)) {\r\n            logMutation(signal, oldValue, newValue)\r\n          }\r\n\r\n          if (!signal.__skipDevSnapshot) {\r\n            saveSnapshot()\r\n          }\r\n\r\n          watchers.forEach(fn => fn(signal, oldValue, newValue))\r\n        },\r\n        configurable: true\r\n      })\r\n    }\r\n  })\r\n\r\n  function matchFilter(signal) {\r\n    if (!devtoolsConfig.logOnly) return true\r\n    return devtoolsConfig.logOnly.has(signal.__devName)\r\n  }\r\n\r\n  function logMutation(signal, oldVal, newVal) {\r\n    console.log(`📦 %cSignal update`, 'color: #09f', {\r\n      name: signal.__devName ?? 'anonymous',\r\n      old: oldVal,\r\n      new: newVal\r\n    })\r\n  }\r\n\r\n  function saveSnapshot() {\r\n    const state = collectSignalStates()\r\n    if (currentIndex < snapshots.length - 1) {\r\n      snapshots.splice(currentIndex + 1)\r\n    }\r\n    snapshots.push(state)\r\n    if (snapshots.length > maxSnapshots) snapshots.shift()\r\n    currentIndex = snapshots.length - 1\r\n  }\r\n\r\n  function collectSignalStates() {\r\n    const all = {}\r\n    for (const signal of Object.values(window.__vaniljSignals ?? {})) {\r\n      const name = signal.__devName ?? signal.toString()\r\n      all[name] = signal.value\r\n    }\r\n    return structuredClone(all)\r\n  }\r\n\r\n  // === Public API ===\r\n\r\n  return {\r\n    config(options) {\r\n      if (options.logOnly) devtoolsConfig.logOnly = new Set(options.logOnly)\r\n    },\r\n\r\n    watch(signal, fn) {\r\n      watchers.add(fn)\r\n      return () => watchers.delete(fn)\r\n    },\r\n\r\n    getHistory() {\r\n      return snapshots.map((s, i) => ({ index: i, snapshot: s }))\r\n    },\r\n\r\n    undo() {\r\n      if (currentIndex > 0) {\r\n        currentIndex--\r\n        restoreSnapshot(snapshots[currentIndex])\r\n      }\r\n    },\r\n\r\n    redo() {\r\n      if (currentIndex < snapshots.length - 1) {\r\n        currentIndex++\r\n        restoreSnapshot(snapshots[currentIndex])\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction restoreSnapshot(snapshot) {\r\n  for (const [name, value] of Object.entries(snapshot)) {\r\n    const s = findSignalByName(name)\r\n    if (s) {\r\n      s.__skipDevLog = true\r\n      s.__skipDevSnapshot = true\r\n      s.value = value\r\n      delete s.__skipDevLog\r\n      delete s.__skipDevSnapshot\r\n    }\r\n  }\r\n}\r\n\r\nfunction findSignalByName(name) {\r\n  return Object.values(window.__vaniljSignals ?? {}).find(s => s.__devName === name)\r\n} \r\n\r\n// Register signal for devtools (optional global registry)\r\nexport function registerSignal(name, signal) {\r\n  window.__vaniljSignals = window.__vaniljSignals || {}\r\n  window.__vaniljSignals[name] = signal\r\n  signal.__devName = name\r\n}","// packages/plugin-devtools/src/index.js - DevTools plugin entry point\r\n\r\nimport { useVaniljPlugin } from '@vanilj/core';\r\n\r\n// Import the devtools functionality\r\nexport { \r\n  useVaniljDevtools, \r\n  registerSignal \r\n} from './devtools.js';\r\n\r\n// Auto-register the plugin when loaded via script tag\r\nif (typeof window !== 'undefined' && window.VaniljCore) {\r\n  // Plugin will be available but not auto-activated\r\n  // Users need to call useVaniljDevtools() explicitly\r\n  console.log('Vanilj DevTools plugin loaded');\r\n}"],"names":["snapshots","currentIndex","watchers","Set","devtoolsConfig","logOnly","restoreSnapshot","snapshot","name","value","Object","entries","s","findSignalByName","__skipDevLog","__skipDevSnapshot","values","window","__vaniljSignals","find","__devName","VaniljCore","console","log","signal","maxSnapshots","useVaniljPlugin","event","data","orig","getOwnPropertyDescriptor","defineProperty","get","set","newValue","oldValue","call","has","matchFilter","oldVal","newVal","old","new","logMutation","state","all","toString","structuredClone","collectSignalStates","length","splice","push","shift","saveSnapshot","forEach","fn","configurable","config","options","watch","add","delete","getHistory","map","i","index","undo","redo"],"mappings":"iTAIA,MAAMA,EAAY,GAClB,IAAIC,GAAe,EACnB,MAAMC,MAAeC,IAErB,IAAIC,EAAiB,CACnBC,QAAS,MAqGX,SAASC,EAAgBC,GACvB,IAAA,MAAYC,EAAMC,KAAUC,OAAOC,QAAQJ,GAAW,CACpD,MAAMK,EAAIC,EAAiBL,GACvBI,IACFA,EAAEE,cAAe,EACjBF,EAAEG,mBAAoB,EACtBH,EAAEH,MAAQA,SACHG,EAAEE,oBACFF,EAAEG,kBAEb,CACF,CAEA,SAASF,EAAiBL,GACxB,OAAOE,OAAOM,OAAOC,OAAOC,iBAAmB,CAAA,GAAIC,KAAKP,GAAKA,EAAEQ,YAAcZ,EAC/E,CClHsB,oBAAXS,QAA0BA,OAAOI,YAG1CC,QAAQC,IAAI,kDDkHP,SAAwBf,EAAMgB,GACnCP,OAAOC,gBAAkBD,OAAOC,iBAAmB,CAAA,EACnDD,OAAOC,gBAAgBV,GAAQgB,EAC/BA,EAAOJ,UAAYZ,CACrB,sBAxHO,UAA2BiB,aAAEA,EAAe,KAAQ,CAAA,GAoEzD,OAnEAH,QAAQC,IAAI,+BAAgC,eAG5CG,kBAAgB,CAACC,EAAOC,KACtB,GAAc,kBAAVD,EAA2B,CAC7B,MAAMH,EAASI,EAAKJ,OAGhBI,EAAKpB,OAAMgB,EAAOJ,UAAYQ,EAAKpB,MAGvC,MAAMqB,EAAOnB,OAAOoB,yBAAyBN,EAAQ,SACrDd,OAAOqB,eAAeP,EAAQ,QAAS,CACrCQ,IAAKH,EAAKG,IACV,GAAAC,CAAIC,GACF,MAAMC,EAAWN,EAAKG,IAAII,KAAKZ,GAC/BK,EAAKI,IAAIG,KAAKZ,EAAQU,IAEjBV,EAAOV,cAepB,SAAqBU,GACnB,OAAKpB,EAAeC,SACbD,EAAeC,QAAQgC,IAAIb,EAAOJ,UAC3C,CAlBoCkB,CAAYd,IAoBhD,SAAqBA,EAAQe,EAAQC,GACnClB,QAAQC,IAAI,qBAAsB,cAAe,CAC/Cf,KAAMgB,EAAOJ,WAAa,YAC1BqB,IAAKF,EACLG,IAAKF,GAET,CAzBUG,CAAYnB,EAAQW,EAAUD,GAG3BV,EAAOT,mBAwBpB,WACE,MAAM6B,EASR,WACE,MAAMC,EAAM,CAAA,EACZ,IAAA,MAAWrB,KAAUd,OAAOM,OAAOC,OAAOC,iBAAmB,CAAA,GAAK,CAEhE2B,EADarB,EAAOJ,WAAaI,EAAOsB,YAC5BtB,EAAOf,KACrB,CACA,OAAOsC,gBAAgBF,EACzB,CAhBgBG,GACV/C,EAAeD,EAAUiD,OAAS,GACpCjD,EAAUkD,OAAOjD,EAAe,GAElCD,EAAUmD,KAAKP,GACX5C,EAAUiD,OAASxB,GAAczB,EAAUoD,QAC/CnD,EAAeD,EAAUiD,OAAS,CACpC,CA/BUI,GAGFnD,EAASoD,QAAQC,GAAMA,EAAG/B,EAAQW,EAAUD,GAC9C,EACAsB,cAAc,GAElB,IAqCK,CACL,MAAAC,CAAOC,GACDA,EAAQrD,UAASD,EAAeC,QAAU,IAAIF,IAAIuD,EAAQrD,SAChE,EAEAsD,MAAA,CAAMnC,EAAQ+B,KACZrD,EAAS0D,IAAIL,GACN,IAAMrD,EAAS2D,OAAON,IAG/BO,WAAA,IACS9D,EAAU+D,IAAI,CAACnD,EAAGoD,KAAA,CAASC,MAAOD,EAAGzD,SAAUK,KAGxD,IAAAsD,GACMjE,EAAe,IACjBA,IACAK,EAAgBN,EAAUC,IAE9B,EAEA,IAAAkE,GACMlE,EAAeD,EAAUiD,OAAS,IACpChD,IACAK,EAAgBN,EAAUC,IAE9B,EAEJ"}