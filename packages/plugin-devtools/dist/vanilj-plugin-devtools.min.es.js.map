{"version":3,"file":"vanilj-plugin-devtools.min.es.js","sources":["../src/devtools.js","../src/index.js"],"sourcesContent":["// vanilj-plugins/devtools.js\r\n\r\nimport { useVaniljPlugin } from '@vanilj/core'\r\n\r\nconst snapshots = []\r\nlet currentIndex = -1\r\nconst watchers = new Set()\r\nconst filters = new Set()\r\nlet devtoolsConfig = {\r\n  logOnly: null // e.g. Set of names or IDs\r\n}\r\n\r\nexport function useVaniljDevtools({ maxSnapshots = 100 } = {}) {\r\n  console.log('%cðŸ› ï¸ Vanilj DevTools active', 'color: #0af')\r\n\r\n  // Add plugin hook\r\n  useVaniljPlugin((event, data) => {\r\n    if (event === 'signal:create') {\r\n      const signal = data.signal\r\n\r\n      // Optional: Assign name for filtering\r\n      if (data.name) signal.__devName = data.name\r\n\r\n      // Patch setter for logging and history\r\n      const orig = Object.getOwnPropertyDescriptor(signal, 'value')\r\n      Object.defineProperty(signal, 'value', {\r\n        get: orig.get,\r\n        set(newValue) {\r\n          const oldValue = orig.get.call(signal)\r\n          orig.set.call(signal, newValue)\r\n\r\n          if (!signal.__skipDevLog && matchFilter(signal)) {\r\n            logMutation(signal, oldValue, newValue)\r\n          }\r\n\r\n          if (!signal.__skipDevSnapshot) {\r\n            saveSnapshot()\r\n          }\r\n\r\n          watchers.forEach(fn => fn(signal, oldValue, newValue))\r\n        },\r\n        configurable: true\r\n      })\r\n    }\r\n  })\r\n\r\n  function matchFilter(signal) {\r\n    if (!devtoolsConfig.logOnly) return true\r\n    return devtoolsConfig.logOnly.has(signal.__devName)\r\n  }\r\n\r\n  function logMutation(signal, oldVal, newVal) {\r\n    console.log(`ðŸ“¦ %cSignal update`, 'color: #09f', {\r\n      name: signal.__devName ?? 'anonymous',\r\n      old: oldVal,\r\n      new: newVal\r\n    })\r\n  }\r\n\r\n  function saveSnapshot() {\r\n    const state = collectSignalStates()\r\n    if (currentIndex < snapshots.length - 1) {\r\n      snapshots.splice(currentIndex + 1)\r\n    }\r\n    snapshots.push(state)\r\n    if (snapshots.length > maxSnapshots) snapshots.shift()\r\n    currentIndex = snapshots.length - 1\r\n  }\r\n\r\n  function collectSignalStates() {\r\n    const all = {}\r\n    for (const signal of Object.values(window.__vaniljSignals ?? {})) {\r\n      const name = signal.__devName ?? signal.toString()\r\n      all[name] = signal.value\r\n    }\r\n    return structuredClone(all)\r\n  }\r\n\r\n  // === Public API ===\r\n\r\n  return {\r\n    config(options) {\r\n      if (options.logOnly) devtoolsConfig.logOnly = new Set(options.logOnly)\r\n    },\r\n\r\n    watch(signal, fn) {\r\n      watchers.add(fn)\r\n      return () => watchers.delete(fn)\r\n    },\r\n\r\n    getHistory() {\r\n      return snapshots.map((s, i) => ({ index: i, snapshot: s }))\r\n    },\r\n\r\n    undo() {\r\n      if (currentIndex > 0) {\r\n        currentIndex--\r\n        restoreSnapshot(snapshots[currentIndex])\r\n      }\r\n    },\r\n\r\n    redo() {\r\n      if (currentIndex < snapshots.length - 1) {\r\n        currentIndex++\r\n        restoreSnapshot(snapshots[currentIndex])\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction restoreSnapshot(snapshot) {\r\n  for (const [name, value] of Object.entries(snapshot)) {\r\n    const s = findSignalByName(name)\r\n    if (s) {\r\n      s.__skipDevLog = true\r\n      s.__skipDevSnapshot = true\r\n      s.value = value\r\n      delete s.__skipDevLog\r\n      delete s.__skipDevSnapshot\r\n    }\r\n  }\r\n}\r\n\r\nfunction findSignalByName(name) {\r\n  return Object.values(window.__vaniljSignals ?? {}).find(s => s.__devName === name)\r\n} \r\n\r\n// Register signal for devtools (optional global registry)\r\nexport function registerSignal(name, signal) {\r\n  window.__vaniljSignals = window.__vaniljSignals || {}\r\n  window.__vaniljSignals[name] = signal\r\n  signal.__devName = name\r\n}","// packages/plugin-devtools/src/index.js - DevTools plugin entry point\r\n\r\nimport { useVaniljPlugin } from '@vanilj/core';\r\n\r\n// Import the devtools functionality\r\nexport { \r\n  useVaniljDevtools, \r\n  registerSignal \r\n} from './devtools.js';\r\n\r\n// Auto-register the plugin when loaded via script tag\r\nif (typeof window !== 'undefined' && window.VaniljCore) {\r\n  // Plugin will be available but not auto-activated\r\n  // Users need to call useVaniljDevtools() explicitly\r\n  console.log('Vanilj DevTools plugin loaded');\r\n}"],"names":[],"mappings":"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"}