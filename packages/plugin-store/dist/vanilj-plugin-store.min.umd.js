!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@vanilj/core")):"function"==typeof define&&define.amd?define(["exports","@vanilj/core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VaniljPluginStore={},e.VaniljCore)}(this,function(e,t){"use strict";function o(e={},o={}){const n={},s=new Set;for(const f in e)n[f]=t.signal(e[f]);const r={};for(const t in n)Object.defineProperty(r,t,{get:()=>n[t].value});const c=()=>{for(const e of s)e(i)},i={state:r,raw:n,snapshot:()=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,t.peek()])),subscribe:e=>(s.add(e),()=>s.delete(e)),set(e,t){n[e]&&(n[e].value=t,c())},update(e){e(i.state),c()},modules:{},inspect:()=>console.table(i.snapshot())};return i}"undefined"!=typeof window&&window.VaniljCore&&console.log("Vanilj Store plugin loaded"),e.createModuleStore=function(e){const t=o();for(const[n,s]of Object.entries(e)){const e=o(s.state||{});t.modules[n]=e}return t},e.createStore=o,e.useMiddleware=function(e,t){for(const[o,n]of Object.entries(e.raw)){const e=n.set;n.set=s=>{const r=n.peek(),c=t(o,s,r);e.call(n,c)}}},e.usePersistedStore=function(e,{key:o="vanilj-store",session:n=!1,exclude:s=[]}={}){const r=n?sessionStorage:localStorage,c=r.getItem(o);if(c)try{const t=JSON.parse(c);for(const[o,n]of Object.entries(t))e.raw[o]&&!s.includes(o)&&(e.raw[o].value=n)}catch{}t.effect(()=>{const t={};for(const[o,n]of Object.entries(e.raw))s.includes(o)||(t[o]=n.value);r.setItem(o,JSON.stringify(t))})},e.useStoreDevtools=function(e,o="VaniljStore"){let n=!1;t.effect(()=>{if(!n){n=!0;try{const t={};for(const[o,n]of Object.entries(e.raw))t[o]=n.value;console.group(`[${o}] Update`),console.table(t),console.groupEnd()}finally{n=!1}}})},e.useSyncedStore=function(e,{send:o,onReceive:n}){t.effect(()=>{const t=e.snapshot();o(t)}),n(t=>{for(const[o,n]of Object.entries(t))e.raw[o]&&(e.raw[o].value=n)})},e.useThunkStore=function(e){const t=o=>{"function"==typeof o&&o(t,e.state)};return t},e.useUndoRedo=function(e,t=null){const o=[];let n=-1;const s=()=>{o.splice(n+1),o.push((()=>{const o=e.snapshot();return t?Object.fromEntries(t.map(e=>[e,o[e]])):o})()),n++};return s(),e.subscribe(s),{undo(){if(n>0){n--;for(const[t,s]of Object.entries(o[n]))e.raw[t]&&(e.raw[t].value=s)}},redo(){if(n<o.length-1){n++;for(const[t,s]of Object.entries(o[n]))e.raw[t]&&(e.raw[t].value=s)}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=vanilj-plugin-store.min.umd.js.map
