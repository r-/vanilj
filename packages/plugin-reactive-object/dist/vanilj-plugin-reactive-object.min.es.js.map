{"version":3,"file":"vanilj-plugin-reactive-object.min.es.js","sources":["../src/reactive-object.js","../src/index.js"],"sourcesContent":["// vanilj-plugins/reactive-objects.js\r\n\r\n// === ðŸ§  Reactive Object System for Vanilj ===\r\n\r\nimport { signal, computed } from '@vanilj/core'\r\n\r\nconst statesSym = Symbol(\"__vanilj_states__\")\r\nconst bindingsSym = Symbol(\"__vanilj_bindings__\")\r\nconst keysGenSym = Symbol(\"__vanilj_keysgen__\")\r\nconst keyToChildSym = Symbol(\"__vanilj_keytochild__\")\r\nconst noreactiveSym = Symbol(\"__vanilj_noreactive__\")\r\n\r\nconst stateProto = Object.getPrototypeOf(signal())\r\n\r\nconst isObject = x => x && typeof x === \"object\" && !Array.isArray(x) && !(x instanceof Function) && !x[noreactiveSym]\r\n\r\nfunction toSignalValue(v) {\r\n  if (v?.__isComputed || v?.subscribe) return v\r\n  if (typeof v === \"function\") return computed(v)\r\n  return signal(isObject(v) ? reactive(v) : v)\r\n}\r\n\r\nfunction buildStates(src) {\r\n  const base = Array.isArray(src) ? [] : {}\r\n  for (const [k, v] of Object.entries(src)) base[k] = toSignalValue(v)\r\n  base[bindingsSym] = []\r\n  base[keysGenSym] = signal(1)\r\n  return base\r\n}\r\n\r\nconst reactiveHandler = {\r\n  get(states, prop, proxy) {\r\n    if (prop === statesSym) return states\r\n    if (prop === Symbol.toStringTag) return \"Reactive\"\r\n    if (prop in states) {\r\n      const val = states[prop]\r\n      if (Object.getPrototypeOf(val) === stateProto) {\r\n        if (Array.isArray(states) && prop === \"length\") {\r\n          states[keysGenSym].value\r\n        }\r\n        return val.value\r\n      }\r\n    }\r\n    return Reflect.get(states, prop, proxy)\r\n  },\r\n\r\n  set(states, prop, value, proxy) {\r\n    if (prop in states && Object.getPrototypeOf(states[prop]) === stateProto) {\r\n      states[prop].value = isObject(value) ? reactive(value) : value\r\n      return true\r\n    }\r\n    states[prop] = toSignalValue(value)\r\n    states[keysGenSym].value++\r\n    return true\r\n  },\r\n\r\n  deleteProperty(states, prop) {\r\n    delete states[prop]\r\n    states[keysGenSym].value++\r\n    return true\r\n  },\r\n\r\n  ownKeys(states) {\r\n    states[keysGenSym].value\r\n    return Reflect.ownKeys(states).filter(k => ![bindingsSym, keysGenSym].includes(k))\r\n  }\r\n}\r\n\r\nexport function reactive(obj) {\r\n  if (!isObject(obj) || obj[statesSym]) return obj\r\n  return new Proxy(buildStates(obj), reactiveHandler)\r\n}\r\n\r\nexport function stateFields(proxyObj) {\r\n  return proxyObj?.[statesSym] || {}\r\n}\r\n\r\nexport function noreactive(obj) {\r\n  obj[noreactiveSym] = true\r\n  return obj\r\n}\r\n\r\nexport function raw(obj) {\r\n  if (!obj?.[statesSym]) return obj\r\n  const out = {}\r\n  for (const [k, signal] of Object.entries(obj[statesSym])) {\r\n    if (Object.getPrototypeOf(signal) === stateProto) {\r\n      out[k] = signal.value\r\n    }\r\n  }\r\n  return out\r\n}\r\n\r\nexport function list(container, reactiveObj, renderFn) {\r\n  const parent = typeof container === \"function\" ? container() : container\r\n  parent[keyToChildSym] = {}\r\n  const states = stateFields(reactiveObj)\r\n  for (const [key, val] of Object.entries(states)) {\r\n    if (Object.getPrototypeOf(val) !== stateProto) continue\r\n    const child = renderFn(reactiveObj[key], () => delete reactiveObj[key], key)\r\n    parent.appendChild(child)\r\n    parent[keyToChildSym][key] = child\r\n  }\r\n  return parent\r\n}\r\n\r\nexport function replace(target, next) {\r\n  const keys = Object.keys({ ...target, ...next })\r\n  for (const k of keys) {\r\n    if (!(k in next)) delete target[k]\r\n    else target[k] = next[k]\r\n  }\r\n  return target\r\n}\r\n\r\nexport function compact(obj) {\r\n  if (Array.isArray(obj)) return obj.filter(Boolean).map(compact)\r\n  if (!isObject(obj)) return obj\r\n  const out = {}\r\n  for (const [k, v] of Object.entries(obj)) {\r\n    if (v != null) out[k] = compact(v)\r\n  }\r\n  return out\r\n}","// packages/plugin-reactive-object/src/index.js - Reactive Object plugin entry point\r\n\r\n// Export the reactive object functionality\r\nexport { \r\n  reactive, \r\n  stateFields, \r\n  noreactive, \r\n  raw, \r\n  list, \r\n  replace, \r\n  compact \r\n} from './reactive-object.js';\r\n\r\n// Auto-register notification when loaded via script tag\r\nif (typeof window !== 'undefined' && window.VaniljCore) {\r\n  console.log('Vanilj Reactive Object plugin loaded');\r\n}"],"names":["signal"],"mappings":"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"}