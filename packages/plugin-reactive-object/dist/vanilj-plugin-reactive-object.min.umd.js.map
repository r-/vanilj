{"version":3,"file":"vanilj-plugin-reactive-object.min.umd.js","sources":["../src/reactive-object.js","../src/index.js"],"sourcesContent":["// vanilj-plugins/reactive-objects.js\r\n\r\n// === ðŸ§  Reactive Object System for Vanilj ===\r\n\r\nimport { signal, computed } from '@vanilj/core'\r\n\r\nconst statesSym = Symbol(\"__vanilj_states__\")\r\nconst bindingsSym = Symbol(\"__vanilj_bindings__\")\r\nconst keysGenSym = Symbol(\"__vanilj_keysgen__\")\r\nconst keyToChildSym = Symbol(\"__vanilj_keytochild__\")\r\nconst noreactiveSym = Symbol(\"__vanilj_noreactive__\")\r\n\r\nconst stateProto = Object.getPrototypeOf(signal())\r\n\r\nconst isObject = x => x && typeof x === \"object\" && !Array.isArray(x) && !(x instanceof Function) && !x[noreactiveSym]\r\n\r\nfunction toSignalValue(v) {\r\n  if (v?.__isComputed || v?.subscribe) return v\r\n  if (typeof v === \"function\") return computed(v)\r\n  return signal(isObject(v) ? reactive(v) : v)\r\n}\r\n\r\nfunction buildStates(src) {\r\n  const base = Array.isArray(src) ? [] : {}\r\n  for (const [k, v] of Object.entries(src)) base[k] = toSignalValue(v)\r\n  base[bindingsSym] = []\r\n  base[keysGenSym] = signal(1)\r\n  return base\r\n}\r\n\r\nconst reactiveHandler = {\r\n  get(states, prop, proxy) {\r\n    if (prop === statesSym) return states\r\n    if (prop === Symbol.toStringTag) return \"Reactive\"\r\n    if (prop in states) {\r\n      const val = states[prop]\r\n      if (Object.getPrototypeOf(val) === stateProto) {\r\n        if (Array.isArray(states) && prop === \"length\") {\r\n          states[keysGenSym].value\r\n        }\r\n        return val.value\r\n      }\r\n    }\r\n    return Reflect.get(states, prop, proxy)\r\n  },\r\n\r\n  set(states, prop, value, proxy) {\r\n    if (prop in states && Object.getPrototypeOf(states[prop]) === stateProto) {\r\n      states[prop].value = isObject(value) ? reactive(value) : value\r\n      return true\r\n    }\r\n    states[prop] = toSignalValue(value)\r\n    states[keysGenSym].value++\r\n    return true\r\n  },\r\n\r\n  deleteProperty(states, prop) {\r\n    delete states[prop]\r\n    states[keysGenSym].value++\r\n    return true\r\n  },\r\n\r\n  ownKeys(states) {\r\n    states[keysGenSym].value\r\n    return Reflect.ownKeys(states).filter(k => ![bindingsSym, keysGenSym].includes(k))\r\n  }\r\n}\r\n\r\nexport function reactive(obj) {\r\n  if (!isObject(obj) || obj[statesSym]) return obj\r\n  return new Proxy(buildStates(obj), reactiveHandler)\r\n}\r\n\r\nexport function stateFields(proxyObj) {\r\n  return proxyObj?.[statesSym] || {}\r\n}\r\n\r\nexport function noreactive(obj) {\r\n  obj[noreactiveSym] = true\r\n  return obj\r\n}\r\n\r\nexport function raw(obj) {\r\n  if (!obj?.[statesSym]) return obj\r\n  const out = {}\r\n  for (const [k, signal] of Object.entries(obj[statesSym])) {\r\n    if (Object.getPrototypeOf(signal) === stateProto) {\r\n      out[k] = signal.value\r\n    }\r\n  }\r\n  return out\r\n}\r\n\r\nexport function list(container, reactiveObj, renderFn) {\r\n  const parent = typeof container === \"function\" ? container() : container\r\n  parent[keyToChildSym] = {}\r\n  const states = stateFields(reactiveObj)\r\n  for (const [key, val] of Object.entries(states)) {\r\n    if (Object.getPrototypeOf(val) !== stateProto) continue\r\n    const child = renderFn(reactiveObj[key], () => delete reactiveObj[key], key)\r\n    parent.appendChild(child)\r\n    parent[keyToChildSym][key] = child\r\n  }\r\n  return parent\r\n}\r\n\r\nexport function replace(target, next) {\r\n  const keys = Object.keys({ ...target, ...next })\r\n  for (const k of keys) {\r\n    if (!(k in next)) delete target[k]\r\n    else target[k] = next[k]\r\n  }\r\n  return target\r\n}\r\n\r\nexport function compact(obj) {\r\n  if (Array.isArray(obj)) return obj.filter(Boolean).map(compact)\r\n  if (!isObject(obj)) return obj\r\n  const out = {}\r\n  for (const [k, v] of Object.entries(obj)) {\r\n    if (v != null) out[k] = compact(v)\r\n  }\r\n  return out\r\n}","// packages/plugin-reactive-object/src/index.js - Reactive Object plugin entry point\r\n\r\n// Export the reactive object functionality\r\nexport { \r\n  reactive, \r\n  stateFields, \r\n  noreactive, \r\n  raw, \r\n  list, \r\n  replace, \r\n  compact \r\n} from './reactive-object.js';\r\n\r\n// Auto-register notification when loaded via script tag\r\nif (typeof window !== 'undefined' && window.VaniljCore) {\r\n  console.log('Vanilj Reactive Object plugin loaded');\r\n}"],"names":["statesSym","Symbol","bindingsSym","keysGenSym","keyToChildSym","noreactiveSym","stateProto","Object","getPrototypeOf","signal","isObject","x","Array","isArray","Function","toSignalValue","v","__isComputed","subscribe","computed","reactive","reactiveHandler","get","states","prop","proxy","toStringTag","val","value","Reflect","set","deleteProperty","ownKeys","filter","k","includes","obj","Proxy","src","base","entries","buildStates","stateFields","proxyObj","window","VaniljCore","console","log","compact","Boolean","map","out","container","reactiveObj","renderFn","parent","key","child","appendChild","target","next","keys"],"mappings":"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"}