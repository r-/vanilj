(function(c,C){typeof exports=="object"&&typeof module<"u"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(c=typeof globalThis<"u"?globalThis:c||self,C(c.vanilj={}))})(this,function(c){"use strict";const C=[];function F(e){C.push(e)}function D(e,t){for(const o of C)o(e,t)}let M=[];function J(e){const t=[];M.push(t);try{return e()}finally{M.pop().forEach(s=>s())}}function H(e){const t=M[M.length-1];t&&t.push(e)}const T=[];let V=!1;const U=new Set;let P=null;function $(e){let t=e;const o=new Set;function s(){T.length&&o.add(T[0])}function a(){D("signal:update",{newValue:t});for(const n of o)V?U.add(n):n()}const r={get value(){return s(),t},set value(n){n!==t&&(t=n,a())},peek:()=>t,subscribe:n=>(o.add(n),()=>o.delete(n)),toString:()=>`Signal {${t}}`};return D("signal:create",{signal:r,initialValue:e}),r}function z(e){return{get value(){return e.value},set value(t){throw new Error("[Vanilj] Cannot assign to readonly signal.")},peek:e.peek,subscribe:e.subscribe,toString:()=>`Readonly {${e.value}}`}}function K(e){const t=$();d(()=>t.value=e());const o={get value(){return t.value},peek:()=>t.peek(),subscribe:t.subscribe,toString:()=>`Computed {${t.value}}`};return D("computed:create",{computed:o}),o}function d(e){const t=[],o=()=>{t.forEach(a=>a()),t.length=0,U.delete(s)},s=()=>{o(),P=t,T.unshift(s);try{D("effect:run",{fn:e}),e(a=>t.push(a))}finally{T.shift(),P=null}};return s(),H(o),o}function Q(e,t){return d(()=>{var s;(s=t.current)!=null&&s.isConnected&&e()})}function X(e){P&&P.push(e)}function Y(e){V=!0;try{e()}finally{V=!1;const t=[...U];U.clear(),t.forEach(o=>o())}}const Z=new Set(["svg","path","circle","rect","line","g","text","polygon","polyline","ellipse","use","defs","marker","clipPath","mask"]);function k(e){return typeof e=="object"&&e!==null&&"value"in e&&typeof e.subscribe=="function"}function L(e){return e.flatMap(t=>Array.isArray(t)?L(t):t)}function N(e){var t;if(e instanceof Node)return e;if(k(e))return N(e.value);if(typeof e=="function"){const o=document.createComment("wrap");let s=[];return d(()=>{var a;const r=e(),n=N(r),i=Array.isArray(n)?n:[n];for(const u of s)u.parentNode&&u.parentNode.removeChild(u);for(const u of i)(a=o.parentNode)==null||a.insertBefore(u,o);s=i}),o}if(Array.isArray(e)){const o=document.createDocumentFragment();for(const s of e){const a=N(s);Array.isArray(a)?a.forEach(r=>o.appendChild(r)):a&&o.appendChild(a)}return o}return document.createTextNode(((t=e==null?void 0:e.toString)==null?void 0:t.call(e))??"")}function R(e,t,...o){const a=Z.has(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(const[r,n]of Object.entries(t||{}))r==="ref"&&typeof n=="function"?n(a):r.startsWith("on")&&typeof n=="function"?a[r.toLowerCase()]=n:typeof n=="function"?d(()=>{if(!a.isConnected)return;const i=n();typeof i=="boolean"?i?a.setAttribute(r,""):a.removeAttribute(r):a.setAttribute(r,i)}):r==="value"&&k(n)?d(()=>{a.isConnected&&(a.value=n.value)}):k(n)?d(()=>{a.isConnected&&a.setAttribute(r,n.value)}):r==="value"?a.value=n:a.setAttribute(r,n);for(const r of L(o)){const n=N(r);Array.isArray(n)?n.forEach(i=>a.appendChild(i)):n!=null&&a.appendChild(n)}return a}const ee=new Proxy({},{get:(e,t)=>R.bind(null,t)});function te(e,t){e.appendChild(t)}function ne(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function oe(e,t){const o=t();return e&&o!==e&&e.replaceWith(o),o}function re(e=null){return{current:e}}function q(){if(typeof crypto<"u"&&crypto.randomUUID)try{return crypto.randomUUID()}catch(e){console.warn("crypto.randomUUID failed, using fallback:",e)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function ie(){return q().slice(0,8)}function se(e,...t){var o;const s=document.createElement("template");let a="";for(let l=0;l<e.length;l++)a+=e[l],l<t.length&&(a+=`<!--::${l}::-->`);a=a.replace(/(\s+)<!--::(\d+)::-->\s*>/g,(l,f,g)=>`${f}data-vanilj-props="${g}"><!--::${g}::-->`),s.innerHTML=a.trim();const r=s.content.cloneNode(!0);r.querySelectorAll("[data-vanilj-props]").forEach(l=>{const f=l.getAttribute("data-vanilj-props"),g=t[Number(f)];if(g&&typeof g=="object")for(const[m,p]of Object.entries(g))O(l,m,p);l.removeAttribute("data-vanilj-props");const S=document.createTreeWalker(l,NodeFilter.SHOW_COMMENT);for(;S.nextNode();){const m=S.currentNode;if(m.nodeValue===`::${f}::`){m.parentNode.removeChild(m);break}}});const i=document.createTreeWalker(r,NodeFilter.SHOW_COMMENT),u=[];for(;i.nextNode();){const l=i.currentNode,f=(o=l.nodeValue)==null?void 0:o.match(/^::(\d+)::$/);f&&u.push({node:l,index:Number(f[1]),parent:l.parentNode})}u.forEach(({node:l,index:f,parent:g})=>{const S=t[f];if(typeof S=="function"||k(S)){const m=document.createComment(`v-start:${f}`),p=document.createComment(`v-end:${f}`);g.insertBefore(m,l),g.insertBefore(p,l),d(()=>{let A=m.nextSibling;for(;A&&A!==p;){const h=A.nextSibling;A.remove(),A=h}const w=N(typeof S=="function"?S():S.value);Array.isArray(w)?w.forEach(h=>p.before(h)):w instanceof Node?p.before(w):w!=null&&p.before(document.createTextNode(String(w)))})}else{const m=N(S);Array.isArray(m)?m.forEach(p=>g.insertBefore(p,l)):m instanceof Node?g.insertBefore(m,l):m!=null&&g.insertBefore(document.createTextNode(String(m)),l)}g.removeChild(l)});const j=r.querySelectorAll("*"),b=/<!--::(\d+)::--/,W=/(<!--::\d+::-->)/;return j.forEach(l=>{for(const f of[...l.attributes]){const g=f.name.match(b);if(g){const h=Number(g[1]),y=t[h],E=typeof y=="function"?y():y;if(E&&typeof E=="object")for(const[ve,be]of Object.entries(E))O(l,ve,be);l.removeAttribute(f.name);continue}if(!f.value.includes("<!--::"))continue;const p=f.value.split(W).filter(h=>h!=="").map(h=>{const y=h.match(b);if(y){const E=Number(y[1]);return t[E]}return h});l.removeAttribute(f.name);const A=p.length===1&&typeof p[0]=="function",w=f.name.startsWith("on");if(w&&A){O(l,f.name,p[0]);continue}if(p.length===1&&!w){O(l,f.name,p[0]);continue}if(w){O(l,f.name,p[0]);continue}d(()=>{const h=p.map(y=>typeof y=="function"?y():k(y)?y.value:y).join("");O(l,f.name,h)})}}),r}function O(e,t,o){if(t.startsWith("on")&&typeof o=="function"){e[t.toLowerCase()]=o;return}const s=t in e,a=r=>{typeof r=="boolean"?s?e[t]=r:r?e.setAttribute(t,""):e.removeAttribute(t):s?e[t]=r:e.setAttribute(t,r)};k(o)?d(()=>a(o.value)):typeof o=="function"?d(()=>a(o())):a(o)}function B(e={},t={}){const o={},s=new Set;for(const i in e)o[i]=$(e[i]);const a={};for(const i in o)Object.defineProperty(a,i,{get:()=>o[i].value});const r=()=>{for(const i of s)i(n)},n={state:a,raw:o,snapshot:()=>Object.fromEntries(Object.entries(o).map(([i,u])=>[i,u.peek()])),subscribe(i){return s.add(i),()=>s.delete(i)},set(i,u){o[i]&&(o[i].value=u,r())},update(i){i(n.state),r()},modules:{},inspect:()=>console.table(n.snapshot())};return n}function ae(e,{key:t="vanilj-store",session:o=!1,exclude:s=[]}={}){const a=o?sessionStorage:localStorage,r=a.getItem(t);if(r)try{const n=JSON.parse(r);for(const[i,u]of Object.entries(n))e.raw[i]&&!s.includes(i)&&(e.raw[i].value=u)}catch{}d(()=>{const n={};for(const[i,u]of Object.entries(e.raw))s.includes(i)||(n[i]=u.value);a.setItem(t,JSON.stringify(n))})}function ce(e,{send:t,onReceive:o}){d(()=>{const s=e.snapshot();t(s)}),o(s=>{for(const[a,r]of Object.entries(s))e.raw[a]&&(e.raw[a].value=r)})}function le(e,t="VaniljStore"){let o=!1;d(()=>{if(!o){o=!0;try{const s={};for(const[a,r]of Object.entries(e.raw))s[a]=r.value;console.group(`[${t}] Update`),console.table(s),console.groupEnd()}finally{o=!1}}})}function ue(e,t=null){const o=[];let s=-1;const a=()=>{const n=e.snapshot();return t?Object.fromEntries(t.map(i=>[i,n[i]])):n},r=()=>{o.splice(s+1),o.push(a()),s++};return r(),e.subscribe(r),{undo(){if(s>0){s--;for(const[n,i]of Object.entries(o[s]))e.raw[n]&&(e.raw[n].value=i)}},redo(){if(s<o.length-1){s++;for(const[n,i]of Object.entries(o[s]))e.raw[n]&&(e.raw[n].value=i)}}}}function fe(e,t){for(const[o,s]of Object.entries(e.raw)){const a=s.set;s.set=r=>{const n=s.peek(),i=t(o,r,n);a.call(s,i)}}}function de(e){const t=o=>{typeof o=="function"&&o(t,e.state)};return t}function pe(e){const t=B();for(const[o,s]of Object.entries(e)){const a=B(s.state||{});t.modules[o]=a}return t}typeof window<"u"&&window.VaniljCore&&console.log("Vanilj Store plugin loaded");function ge(e,t){if(!e||!t||typeof t.t!="function")return;e.querySelectorAll("[data-i18n-key]").forEach(r=>{const n=r.getAttribute("data-i18n-key");!n||r.__i18nBound||(r.__i18nBound=!0,d(()=>{const i=t.t(n);if(i===void 0){console.warn(`[i18n] Missing key: "${n}"`);return}r.textContent=i}))}),e.querySelectorAll("[data-i18n-attr]").forEach(r=>{const n=r.getAttribute("data-i18n-attr");!n||r.__i18nAttrBound||(r.__i18nAttrBound=!0,n.split(",").forEach(i=>{const[u,j]=i.split(":").map(b=>b.trim());!u||!j||d(()=>{const b=t.t(j);if(b===void 0){console.warn(`[i18n] Missing key: "${j}"`);return}r.setAttribute(u,b)})}))}),e.querySelectorAll("[data-i18n-html]").forEach(r=>{const n=r.getAttribute("data-i18n-html");!n||r.__i18nHtmlBound||(r.__i18nHtmlBound=!0,d(()=>{const i=t.t(n);if(i===void 0){console.warn(`[i18n] Missing key: "${n}"`);return}r.innerHTML=i}))})}typeof window<"u"&&window.VaniljCore&&console.log("Vanilj i18n plugin loaded");const v=[];let _=-1;const I=new Set;let x={logOnly:null};function me({maxSnapshots:e=100}={}){console.log("%c🛠️ Vanilj DevTools active","color: #0af"),F((r,n)=>{if(r==="signal:create"){const i=n.signal;n.name&&(i.__devName=n.name);const u=Object.getOwnPropertyDescriptor(i,"value");Object.defineProperty(i,"value",{get:u.get,set(j){const b=u.get.call(i);u.set.call(i,j),!i.__skipDevLog&&t(i)&&o(i,b,j),i.__skipDevSnapshot||s(),I.forEach(W=>W(i,b,j))},configurable:!0})}});function t(r){return x.logOnly?x.logOnly.has(r.__devName):!0}function o(r,n,i){console.log("📦 %cSignal update","color: #09f",{name:r.__devName??"anonymous",old:n,new:i})}function s(){const r=a();_<v.length-1&&v.splice(_+1),v.push(r),v.length>e&&v.shift(),_=v.length-1}function a(){const r={};for(const n of Object.values(window.__vaniljSignals??{})){const i=n.__devName??n.toString();r[i]=n.value}return structuredClone(r)}return{config(r){r.logOnly&&(x.logOnly=new Set(r.logOnly))},watch(r,n){return I.add(n),()=>I.delete(n)},getHistory(){return v.map((r,n)=>({index:n,snapshot:r}))},undo(){_>0&&(_--,G(v[_]))},redo(){_<v.length-1&&(_++,G(v[_]))}}}function G(e){for(const[t,o]of Object.entries(e)){const s=he(t);s&&(s.__skipDevLog=!0,s.__skipDevSnapshot=!0,s.value=o,delete s.__skipDevLog,delete s.__skipDevSnapshot)}}function he(e){return Object.values(window.__vaniljSignals??{}).find(t=>t.__devName===e)}function ye(e,t){window.__vaniljSignals=window.__vaniljSignals||{},window.__vaniljSignals[e]=t,t.__devName=e}typeof window<"u"&&window.VaniljCore&&console.log("Vanilj DevTools plugin loaded"),c.batch=Y,c.computed=K,c.createElement=R,c.createModuleStore=pe,c.createStore=B,c.effect=d,c.generateShortUUID=ie,c.generateUUID=q,c.html=se,c.hydrate=oe,c.initI18n=ge,c.isSignal=k,c.mount=te,c.onCleanup=X,c.readonly=z,c.ref=re,c.registerScopedEffectCleanup=H,c.registerSignal=ye,c.runWithScopedEffects=J,c.safeEffect=Q,c.signal=$,c.tags=ee,c.unmount=ne,c.useMiddleware=fe,c.usePersistedStore=ae,c.useStoreDevtools=le,c.useSyncedStore=ce,c.useThunkStore=de,c.useUndoRedo=ue,c.useVaniljDevtools=me,c.useVaniljPlugin=F,c.wrap=N,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
