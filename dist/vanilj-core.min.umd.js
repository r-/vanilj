!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VaniljCore={})}(this,function(e){"use strict";const t=[];function n(e,n){for(const o of t)o(e,n)}let o=[];function r(e){const t=o[o.length-1];t&&t.push(e)}const c=[];let a=!1;const u=new Set;let i=null;function l(e){let t=e;const o=new Set;const r={get value(){return c.length&&o.add(c[0]),t},set value(e){e!==t&&(t=e,function(){n("signal:update",{newValue:t});for(const e of o)a?u.add(e):e()}())},peek:()=>t,subscribe:e=>(o.add(e),()=>o.delete(e)),toString:()=>`Signal {${t}}`};return n("signal:create",{signal:r,initialValue:e}),r}function s(e){return{get value(){return e.value},set value(e){throw new Error("[Vanilj] Cannot assign to readonly signal.")},peek:e.peek,subscribe:e.subscribe,toString:()=>`Readonly {${e.value}}`}}function f(e){const t=l();d(()=>t.value=e());const o={get value(){return t.value},peek:()=>t.peek(),subscribe:t.subscribe,toString:()=>`Computed {${t.value}}`};return n("computed:create",{computed:o}),o}function d(e){const t=[],o=()=>{t.forEach(e=>e()),t.length=0,u.delete(a)},a=()=>{o(),i=t,c.unshift(a);try{n("effect:run",{fn:e}),e(e=>t.push(e))}finally{c.shift(),i=null}};return a(),r(o),o}function p(e){a=!0;try{e()}finally{a=!1;const e=[...u];u.clear(),e.forEach(e=>e())}}const m=new Set(["svg","path","circle","rect","line","g","text","polygon","polyline","ellipse","use","defs","marker","clipPath","mask"]);function y(e){return"object"==typeof e&&null!==e&&"value"in e&&"function"==typeof e.subscribe}function h(e){return e.flatMap(e=>Array.isArray(e)?h(e):e)}function b(e){var t;if(e instanceof Node)return e;if(y(e))return b(e.value);if("function"==typeof e){const t=document.createComment("wrap");let n=[];return d(()=>{var o;const r=b(e()),c=Array.isArray(r)?r:[r];for(const e of n)e.parentNode&&e.parentNode.removeChild(e);for(const e of c)null==(o=t.parentNode)||o.insertBefore(e,t);n=c}),t}if(Array.isArray(e)){const t=document.createDocumentFragment();for(const n of e){const e=b(n);Array.isArray(e)?e.forEach(e=>t.appendChild(e)):e&&t.appendChild(e)}return t}return document.createTextNode((null==(t=null==e?void 0:e.toString)?void 0:t.call(e))??"")}function v(e,t,...n){const o=m.has(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(const[r,c]of Object.entries(t||{}))"ref"===r&&"function"==typeof c?c(o):r.startsWith("on")&&"function"==typeof c?o[r.toLowerCase()]=c:"function"==typeof c?d(()=>{if(!o.isConnected)return;const e=c();"boolean"==typeof e?e?o.setAttribute(r,""):o.removeAttribute(r):o.setAttribute(r,e)}):"value"===r&&y(c)?d(()=>{o.isConnected&&(o.value=c.value)}):y(c)?d(()=>{o.isConnected&&o.setAttribute(r,c.value)}):"value"===r?o.value=c:o.setAttribute(r,c);for(const r of h(n)){const e=b(r);Array.isArray(e)?e.forEach(e=>o.appendChild(e)):null!=e&&o.appendChild(e)}return o}const g=new Proxy({},{get:(e,t)=>v.bind(null,t)});function x(e,t){e.appendChild(t)}function A(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function N(e=null){return{current:e}}function C(){if("undefined"!=typeof crypto&&crypto.randomUUID)try{return crypto.randomUUID()}catch(e){console.warn("crypto.randomUUID failed, using fallback:",e)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function S(){return C().slice(0,8)}function E(e,...t){var n;const o=document.createElement("template");let r="";for(let f=0;f<e.length;f++)r+=e[f],f<t.length&&(r+=`\x3c!--::${f}::--\x3e`);r=r.replace(/(\s+)<!--::(\d+)::-->\s*>/g,(e,t,n)=>`${t}data-vanilj-props="${n}">\x3c!--::${n}::--\x3e`),o.innerHTML=r.trim();const c=o.content.cloneNode(!0);c.querySelectorAll("[data-vanilj-props]").forEach(e=>{const n=e.getAttribute("data-vanilj-props"),o=t[Number(n)];if(o&&"object"==typeof o)for(const[t,c]of Object.entries(o))j(e,t,c);e.removeAttribute("data-vanilj-props");const r=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT);for(;r.nextNode();){const e=r.currentNode;if(e.nodeValue===`::${n}::`){e.parentNode.removeChild(e);break}}});const a=document.createTreeWalker(c,NodeFilter.SHOW_COMMENT),u=[];for(;a.nextNode();){const e=a.currentNode,t=null==(n=e.nodeValue)?void 0:n.match(/^::(\d+)::$/);t&&u.push({node:e,index:Number(t[1]),parent:e.parentNode})}u.forEach(({node:e,index:n,parent:o})=>{const r=t[n];if("function"==typeof r||y(r)){const t=document.createComment(`v-start:${n}`),c=document.createComment(`v-end:${n}`);o.insertBefore(t,e),o.insertBefore(c,e),d(()=>{let e=t.nextSibling;for(;e&&e!==c;){const t=e.nextSibling;e.remove(),e=t}const n=b("function"==typeof r?r():r.value);Array.isArray(n)?n.forEach(e=>c.before(e)):n instanceof Node?c.before(n):null!=n&&c.before(document.createTextNode(String(n)))})}else{const t=b(r);Array.isArray(t)?t.forEach(t=>o.insertBefore(t,e)):t instanceof Node?o.insertBefore(t,e):null!=t&&o.insertBefore(document.createTextNode(String(t)),e)}o.removeChild(e)});const i=c.querySelectorAll("*"),l=/<!--::(\d+)::--/,s=/(<!--::\d+::-->)/;return i.forEach(e=>{for(const n of[...e.attributes]){const o=n.name.match(l);if(o){const r=Number(o[1]),c=t[r],a="function"==typeof c?c():c;if(a&&"object"==typeof a)for(const[t,n]of Object.entries(a))j(e,t,n);e.removeAttribute(n.name);continue}if(!n.value.includes("\x3c!--::"))continue;const r=n.value.split(s).filter(e=>""!==e).map(e=>{const n=e.match(l);if(n){const e=Number(n[1]);return t[e]}return e});e.removeAttribute(n.name);const c=1===r.length&&"function"==typeof r[0],a=n.name.startsWith("on");a&&c?j(e,n.name,r[0]):1!==r.length||a?a?j(e,n.name,r[0]):d(()=>{const t=r.map(e=>"function"==typeof e?e():y(e)?e.value:e).join("");j(e,n.name,t)}):j(e,n.name,r[0])}}),c}function j(e,t,n){if(t.startsWith("on")&&"function"==typeof n)return void(e[t.toLowerCase()]=n);const o=t in e,r=n=>{"boolean"==typeof n?o?e[t]=n:n?e.setAttribute(t,""):e.removeAttribute(t):o?e[t]=n:e.setAttribute(t,n)};y(n)?d(()=>r(n.value)):"function"==typeof n?d(()=>r(n())):r(n)}const w={signal:l,readonly:s,computed:f,effect:d,batch:p,createElement:v,tags:g,mount:x,unmount:A,html:E,ref:N,generateUUID:C,generateShortUUID:S};e.batch=p,e.computed=f,e.createElement=v,e.default=w,e.effect=d,e.generateShortUUID=S,e.generateUUID=C,e.html=E,e.hydrate=function(e,t){const n=t();return e&&n!==e&&e.replaceWith(n),n},e.isSignal=y,e.mount=x,e.onCleanup=function(e){i&&i.push(e)},e.readonly=s,e.ref=N,e.registerScopedEffectCleanup=r,e.runWithScopedEffects=function(e){o.push([]);try{return e()}finally{o.pop().forEach(e=>e())}},e.safeEffect=function(e,t){return d(()=>{var n;(null==(n=t.current)?void 0:n.isConnected)&&e()})},e.signal=l,e.tags=g,e.unmount=A,e.useVaniljPlugin=function(e){t.push(e)},e.wrap=b,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vanilj-core.umd.js.map
